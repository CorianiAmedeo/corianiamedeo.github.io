var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function re(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var S={exports:{}},D,k;function ie(){if(k)return D;k=1;var s;return typeof window<"u"?s=window:typeof W<"u"?s=W:typeof self<"u"?s=self:s={},D=s,D}var I,j;function ne(){if(j)return I;j=1,I=n;var s=Object.prototype.toString;function n(t){if(!t)return!1;var e=s.call(t);return e==="[object Function]"||typeof t=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}return I}var C,V;function se(){if(V)return C;V=1;var s=function(t){return t.replace(/^\s+|\s+$/g,"")},n=function(t){return Object.prototype.toString.call(t)==="[object Array]"};return C=function(t){if(!t)return{};for(var e=Object.create(null),i=s(t).split(`
`),r=0;r<i.length;r++){var u=i[r],o=u.indexOf(":"),l=s(u.slice(0,o)).toLowerCase(),h=s(u.slice(o+1));typeof e[l]>"u"?e[l]=h:n(e[l])?e[l].push(h):e[l]=[e[l],h]}return e},C}var B,z;function ae(){if(z)return B;z=1,B=n;var s=Object.prototype.hasOwnProperty;function n(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var r in i)s.call(i,r)&&(t[r]=i[r])}return t}return B}var Y;function ue(){if(Y)return S.exports;Y=1;var s=ie(),n=ne(),t=se(),e=ae();S.exports=o,S.exports.default=o,o.XMLHttpRequest=s.XMLHttpRequest||c,o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:s.XDomainRequest,i(["get","put","post","patch","head","delete"],function(a){o[a==="delete"?"del":a]=function(f,d,v){return d=u(f,d,v),d.method=a.toUpperCase(),l(d)}});function i(a,f){for(var d=0;d<a.length;d++)f(a[d])}function r(a){for(var f in a)if(a.hasOwnProperty(f))return!1;return!0}function u(a,f,d){var v=a;return n(f)?(d=f,typeof a=="string"&&(v={uri:a})):v=e(f,{uri:a}),v.callback=d,v}function o(a,f,d){return f=u(a,f,d),l(f)}function l(a){if(typeof a.callback>"u")throw new Error("callback argument missing");var f=!1,d=function(b,U,te){f||(f=!0,a.callback(b,U,te))};function v(){g.readyState===4&&setTimeout(p,0)}function E(){var T=void 0;if(g.response?T=g.response:T=g.responseText||h(g),O)try{T=JSON.parse(T)}catch{}return T}function m(T){return clearTimeout(M),T instanceof Error||(T=new Error(""+(T||"Unknown XMLHttpRequest Error"))),T.statusCode=0,d(T,q)}function p(){if(!_){var T;clearTimeout(M),a.useXDR&&g.status===void 0?T=200:T=g.status===1223?204:g.status;var b=q,U=null;return T!==0?(b={body:E(),statusCode:T,method:A,headers:{},url:F,rawRequest:g},g.getAllResponseHeaders&&(b.headers=t(g.getAllResponseHeaders()))):U=new Error("Internal XMLHttpRequest Error"),d(U,b,b.body)}}var g=a.xhr||null;g||(a.cors||a.useXDR?g=new o.XDomainRequest:g=new o.XMLHttpRequest);var R,_,F=g.url=a.uri||a.url,A=g.method=a.method||"GET",L=a.body||a.data,y=g.headers=a.headers||{},X=!!a.sync,O=!1,M,q={body:void 0,headers:{},statusCode:0,method:A,url:F,rawRequest:g};if("json"in a&&a.json!==!1&&(O=!0,y.accept||y.Accept||(y.Accept="application/json"),A!=="GET"&&A!=="HEAD"&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),L=JSON.stringify(a.json===!0?L:a.json))),g.onreadystatechange=v,g.onload=p,g.onerror=m,g.onprogress=function(){},g.onabort=function(){_=!0},g.ontimeout=m,g.open(A,F,!X,a.username,a.password),X||(g.withCredentials=!!a.withCredentials),!X&&a.timeout>0&&(M=setTimeout(function(){if(!_){_=!0,g.abort("timeout");var T=new Error("XMLHttpRequest timeout");T.code="ETIMEDOUT",m(T)}},a.timeout)),g.setRequestHeader)for(R in y)y.hasOwnProperty(R)&&g.setRequestHeader(R,y[R]);else if(a.headers&&!r(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(g.responseType=a.responseType),"beforeSend"in a&&typeof a.beforeSend=="function"&&a.beforeSend(g),g.send(L||null),g}function h(a){try{if(a.responseType==="document")return a.responseXML;var f=a.responseXML&&a.responseXML.documentElement.nodeName==="parsererror";if(a.responseType===""&&!f)return a.responseXML}catch{}return null}function c(){}return S.exports}var oe=ue();const Q=re(oe);var P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},$=function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")},Z=function(){function s(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(n,t,e){return t&&s(n.prototype,t),e&&s(n,e),n}}(),G=function(s){if(Array.isArray(s)){for(var n=0,t=Array(s.length);n<s.length;n++)t[n]=s[n];return t}else return Array.from(s)},w="";function le(s){return`
<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>
<td align="center">
<div style="display: table-cell; vertical-align: middle;">
<div style="">`+s+`</div>
</div>
</td></tr></table>
`}var he=`
	This page requires a browser that supports WebGL.<br/>
	<a href="http://get.webgl.org">Click here to upgrade your browser.</a>
`,fe=`
	It does not appear your computer can support WebGL.<br/>
	<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>
`,de=1,ge=2;function ce(s,n,t){function e(u){var o=s.parentNode;o&&(o.innerHTML=le(u))}function i(u,o){typeof t=="function"?t(u):e(o)}if(!window.WebGLRenderingContext)return i(de,he),null;var r=ve(s,n);return r?r.getExtension("OES_standard_derivatives"):i(ge,fe),r}function ve(s,n){for(var t=["webgl","experimental-webgl"],e=null,i=0;i<t.length;++i)try{e=s.getContext(t[i],n)}catch{if(e)break}return e}function x(s,n,t,e){var i=s.gl,r=i.createShader(t);i.shaderSource(r,n),i.compileShader(r);var u=i.getShaderParameter(r,i.COMPILE_STATUS);return u?r:(w=i.getShaderInfoLog(r),console.error("*** Error compiling shader "+r+":"+w),s.trigger("error",{shader:r,source:n,type:t,error:w,offset:e||0}),i.deleteShader(r),null)}function J(s,n,t,e){for(var i=s.gl,r=i.createProgram(),u=0;u<n.length;++u)i.attachShader(r,n[u]);i.linkProgram(r);var o=i.getProgramParameter(r,i.LINK_STATUS);return o?r:(w=i.getProgramInfoLog(r),console.log("Error in program linking:"+w),i.deleteProgram(r),null)}function H(s){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=[];for(var e in s){var i=s[e],r=void 0;if(n&&(e=n+"."+e),typeof i=="number")t.push({type:"float",method:"1f",name:e,value:i});else if(Array.isArray(i)){if(typeof i[0]=="number")i.length===1?t.push({type:"float",method:"1f",name:e,value:i}):i.length>=2&&i.length<=4?t.push({type:"vec"+i.length,method:i.length+"fv",name:e,value:i}):i.length>4&&t.push({type:"float[]",method:"1fv",name:e+"[0]",value:i});else if(typeof i[0]=="string")t.push({type:"sampler2D",method:"1i",name:e,value:i});else if(Array.isArray(i[0])&&typeof i[0][0]=="number"){if(i[0].length>=2&&i[0].length<=4)for(r=0;r<i.length;r++)t.push({type:"vec"+i[0].length,method:i[r].length+"fv",name:e+"["+r+"]",value:i[r]})}else if(P(i[0])==="object")for(r=0;r<i.length;r++)t.push.apply(t,G(H(i[r],e+"["+r+"]")))}else typeof i=="boolean"?t.push({type:"bool",method:"1i",name:e,value:i}):typeof i=="string"?t.push({type:"sampler2D",method:"1i",name:e,value:i}):(typeof i>"u"?"undefined":P(i))==="object"&&t.push.apply(t,G(H(i,e)))}return t}function Ee(s){var n=s.getBoundingClientRect();return n.top+n.height>0&&n.top<(window.innerHeight||document.documentElement.clientHeight)}function K(s){return(s&s-1)===0}function Te(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function me(s,n){return s&&n?s.toString()!==n.toString():!1}function pe(s){var n=new XMLHttpRequest;return n.open("GET",s,!1),n.send(),n.status==200?n.responseText:""}function ee(s){var n=new Set;return Object.assign(s,{on:function(e,i){var r={};r[e]=i,n.add(r)},off:function(e,i){if(i){var r={};r[e]=i,n.delete(r)}else{var u=!0,o=!1,l=void 0;try{for(var h=n[Symbol.iterator](),c;!(u=(c=h.next()).done);u=!0){var a=c.value,f=!0,d=!1,v=void 0;try{for(var E=Object.keys(a)[Symbol.iterator](),m;!(f=(m=E.next()).done);f=!0){var p=m.value;if(p===e){n.delete(a);return}}}catch(g){d=!0,v=g}finally{try{!f&&E.return&&E.return()}finally{if(d)throw v}}}}catch(g){o=!0,l=g}finally{try{!u&&h.return&&h.return()}finally{if(o)throw l}}}},listSubscriptions:function(){var e=!0,i=!1,r=void 0;try{for(var u=n[Symbol.iterator](),o;!(e=(o=u.next()).done);e=!0){var l=o.value;console.log(l)}}catch(h){i=!0,r=h}finally{try{!e&&u.return&&u.return()}finally{if(i)throw r}}},subscribe:function(e){n.add(e)},unsubscribe:function(e){n.delete(e)},unsubscribeAll:function(){n.clear()},trigger:function(e){for(var i=arguments.length,r=Array(i>1?i-1:0),u=1;u<i;u++)r[u-1]=arguments[u];var o=!0,l=!1,h=void 0;try{for(var c=n[Symbol.iterator](),a;!(o=(a=c.next()).done);o=!0){var f=a.value;typeof f[e]=="function"&&f[e].apply(f,G(r))}}catch(d){l=!0,h=d}finally{try{!o&&c.return&&c.return()}finally{if(l)throw h}}}})}var N=function(){function s(n,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};$(this,s),ee(this),this.gl=n,this.texture=n.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=t,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(e.filtering),this.load(e)}return Z(s,[{key:"destroy",value:function(){this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(t){this.valid&&(typeof t=="number"&&s.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),s.activeUnit=t),s.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),s.activeTexture=this.texture))}},{key:"load",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.loading=null,typeof t.url=="string"?(this.url===void 0||t.url!==this.url)&&this.setUrl(t.url,t):t.element?this.setElement(t.element,t):t.data&&t.width&&t.height&&this.setData(t.width,t.height,t.data,t)}},{key:"setUrl",value:function(t){var e=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.valid)return this.url=t,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,u){var o=t.split(".").pop().toLowerCase(),l=o==="ogv"||o==="webm"||o==="mp4",h=void 0;l?(h=document.createElement("video"),h.autoplay=!0,h.muted=!0,setTimeout(function(){h.play()},1),i.filtering="nearest"):h=new Image,h.onload=function(){try{e.setElement(h,i)}catch(c){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",c,i)}r(e)},h.onerror=function(c){console.log("Texture '"+e.name+"': failed to load url: '"+e.source+"'",c,i),r(e)},Te()&&e.source.slice(0,5)==="data:"||(h.crossOrigin="anonymous"),h.src=e.source,l&&e.setElement(h,i)}),this.loading}},{key:"setData",value:function(t,e,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.width=t,this.height=e,this.source=i,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var i=this,r=t;if(typeof t=="string"&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.source=t,this.sourceType="element",t instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,t.addEventListener("canplaythrough",function(){i.intervalID=setInterval(function(){i.update(e)},15)},!0),t.addEventListener("ended",function(){t.currentTime=0,t.play()},!0)):this.update(e),this.setFiltering(e);else{var u="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";u+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+u,e)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,t.UNPACK_FLIP_Y_WEBGL!==!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.sourceType==="element"&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):this.sourceType==="data"&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.valid){this.powerOf2=K(this.width)&&K(this.height),this.filtering=t.filtering||"linear";var e=this.gl;this.bind(),this.powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||e.REPEAT),this.filtering==="mipmap"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering==="linear"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):this.filtering==="nearest"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.filtering==="mipmap"&&(this.filtering="linear"),this.filtering==="nearest"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)))}}}]),s}();N.getMaxTextureSize=function(s){return s.getParameter(s.MAX_TEXTURE_SIZE)};N.activeUnit=-1;var Re=function(){function s(n,t,e){var i=this;$(this,s),ee(this),t=t||{},e=e||{},n.hasAttribute("data-fullscreen")&&(n.getAttribute("data-fullscreen")=="1"||n.getAttribute("data-fullscreen")=="true")?(this.width=window.innerWidth,this.height=window.innerHeight,n.width=window.innerWidth,n.height=window.innerHeight):(this.width=n.clientWidth,this.height=n.clientHeight),this.canvas=n,this.gl=void 0,this.deps={},this.program=void 0,this.textures={},this.buffers={},this.uniforms={},this.vbo={},this.isValid=!1,this.animationFrameRequest=void 0,this.BUFFER_COUNT=0,this.vertexString=t.vertexString||`
#ifdef GL_ES
precision mediump float;
#endif

attribute vec2 a_position;
attribute vec2 a_texcoord;

varying vec2 v_texcoord;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texcoord = a_texcoord;
}
`,this.fragmentString=t.fragmentString||`
#ifdef GL_ES
precision mediump float;
#endif

varying vec2 v_texcoord;

void main(){
    gl_FragColor = vec4(0.0);
}
`;var r=ce(n,t,e.onError);if(!r)return;if(this.gl=r,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,this.realToCSSPixels=window.devicePixelRatio||1,n.style.backgroundColor=t.backgroundColor||"rgba(1,1,1,0)",n.hasAttribute("data-fragment"))this.fragmentString=n.getAttribute("data-fragment");else if(n.hasAttribute("data-fragment-url")){var u=n.getAttribute("data-fragment-url");Q.get(u,function(E,m,p){i.load(p,i.vertexString)})}if(n.hasAttribute("data-vertex"))this.vertexString=n.getAttribute("data-vertex");else if(n.hasAttribute("data-vertex-url")){var o=n.getAttribute("data-vertex-url");Q.get(o,function(E,m,p){i.load(i.fragmentString,p)})}if(this.load(),!this.program)return;var l=r.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,r.FLOAT,!1,0,0);var h=r.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(h),this.gl.vertexAttribPointer(h,2,r.FLOAT,!1,0,0),n.hasAttribute("data-textures")){var c=n.getAttribute("data-textures").split(",");for(var a in c)this.setUniform("u_tex"+a,c[a])}var f={x:0,y:0};document.addEventListener("mousemove",function(E){f.x=E.clientX||E.pageX,f.y=E.clientY||E.pageY},!1);var d=this;function v(){d.nMouse>1&&d.setMouse(f),d.resize()&&(d.forceRender=!0),d.render(),d.animationFrameRequest=window.requestAnimationFrame(v)}return this.setMouse({x:0,y:0}),v(),this}return Z(s,[{key:"destroy",value:function(){cancelAnimationFrame(this.animationFrameRequest),this.animated=!1,this.isValid=!1;for(var t in this.textures)t.destroy&&t.destroy();this.textures={};for(var e in this.attribs)this.gl.deleteBuffer(this.attribs[e]);this.gl.useProgram(null),this.gl.deleteProgram(this.program);for(var i in this.buffers){var r=this.buffers[i];this.gl.deleteProgram(r.program)}this.program=null,this.gl=null}},{key:"load",value:function(t,e){var i=this;e&&(this.vertexString=e),t&&(this.fragmentString=t);var r=this.fragmentString.split(/\r?\n/);this.fragmentString=`#define PLATFORM_WEBGL
#line 0
`,r.forEach(function(m,p){var g=m.trim();if(g.startsWith('#include "lygia')){var R=g.substring(15).replace(/\'|\"|\;|\s/g,"");if(R.endsWith("glsl")){if(i.deps[R]===void 0){var _="https://lygia.xyz"+R;i.deps[R]=pe(_)}i.fragmentString+=i.deps[R]+`
#line `+(p+1)+`
`}}else i.fragmentString+=m+`
`}),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1;var u=this.fragmentString.search(/sampler2D/g);if(u)for(var o=this.fragmentString.split(`
`),l=0;l<o.length;l++){var h=o[l].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(h){var c=h[2].split(".").pop().toLowerCase();h[1]&&h[2]&&(c==="jpg"||c==="jpeg"||c==="png"||c==="ogv"||c==="webm"||c==="mp4")&&this.setUniform(h[1],h[2])}var a=o[l].match(/\s*void\s*main\s*/g);if(a)break}var f=x(this,this.vertexString,this.gl.VERTEX_SHADER),d=x(this,this.fragmentString,this.gl.FRAGMENT_SHADER);d?this.isValid=!0:(d=x(this,`void main(){
	gl_FragColor = vec4(1.0);
}`,this.gl.FRAGMENT_SHADER),this.isValid=!1);var v=J(this,[f,d]);this.gl.useProgram(v),this.gl.deleteShader(f),this.gl.deleteShader(d),this.program=v,this.change=!0,this.BUFFER_COUNT=0;var E=this.getBuffers(this.fragmentString);Object.keys(E).length&&this.loadPrograms(E),this.buffers=E,this.texureIndex=this.BUFFER_COUNT,this.trigger("load",{}),this.forceRender=!0,this.render()}},{key:"test",value:function(t,e,i){var r=this.vertexString,u=this.fragmentString,o=this.paused,l=this.gl.getExtension("EXT_disjoint_timer_query"),h=l.createQueryEXT(),c=this.isValid;(e||i)&&(this.load(e,i),c=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,l.beginQueryEXT(l.TIME_ELAPSED_EXT,h),this.forceRender=!0,this.render(),l.endQueryEXT(l.TIME_ELAPSED_EXT);var a=this;function f(){a.paused=o,(e||i)&&a.load(u,r)}function d(){a.forceRender=!0,a.render();var v=l.getQueryObjectEXT(h,l.QUERY_RESULT_AVAILABLE_EXT),E=a.gl.getParameter(l.GPU_DISJOINT_EXT);if(v&&!E){var m={wasValid:c,frag:e||a.fragmentString,vert:i||a.vertexString,timeElapsedMs:l.getQueryObjectEXT(h,l.QUERY_RESULT_EXT)/1e6};f(),t(m)}else window.requestAnimationFrame(d)}d()}},{key:"loadTexture",value:function(t,e,i){var r=this;i||(i={}),typeof e=="string"?i.url=e:(typeof e>"u"?"undefined":P(e))==="object"&&e.data&&e.width&&e.height?(i.data=e.data,i.width=e.width,i.height=e.height):(typeof e>"u"?"undefined":P(e))==="object"&&(i.element=e),this.textures[t]?this.textures[t]&&(this.textures[t].load(i),this.textures[t].on("loaded",function(u){r.forceRender=!0})):(this.textures[t]=new N(this.gl,t,i),this.textures[t].on("loaded",function(u){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(t){for(var e={},i=arguments.length,r=Array(i>1?i-1:0),u=1;u<i;u++)r[u-1]=arguments[u];e[t]=r,this.setUniforms(e)}},{key:"setUniforms",value:function(t){var e=H(t);for(var i in e)e[i].type==="sampler2D"?this.loadTexture(e[i].name,e[i].value[0]):this.uniform(e[i].method,e[i].type,e[i].name,e[i].value);this.forceRender=!0}},{key:"setMouse",value:function(t){var e=this.canvas.getBoundingClientRect();if(t&&t.x&&t.x>=e.left&&t.x<=e.right&&t.y&&t.y>=e.top&&t.y<=e.bottom){var i=(t.x-e.left)*this.realToCSSPixels,r=this.canvas.height-(t.y-e.top)*this.realToCSSPixels;this.uniform("2f","vec2","u_mouse",i,r)}}},{key:"uniform",value:function(t,e,i){this.uniforms[i]=this.uniforms[i]||{};for(var r=this.uniforms[i],u=arguments.length,o=Array(u>3?u-3:0),l=3;l<u;l++)o[l-3]=arguments[l];var h=me(r.value,o);if(h||this.change||!r.location||!r.value){r.name=i,r.type=e,r.value=o,r.method="uniform"+t,this.gl.useProgram(this.program),r.location=this.gl.getUniformLocation(this.program,i),this.gl[r.method].apply(this.gl,[r.location].concat(r.value));for(var c in this.buffers){var a=this.buffers[c];this.gl.useProgram(a.program);var f=this.gl.getUniformLocation(a.program,i);this.gl[r.method].apply(this.gl,[f].concat(r.value))}}}},{key:"uniformTexture",value:function(t,e,i){if(this.textures[t]===void 0)this.loadTexture(t,e,i);else{this.uniform("1i","sampler2D",t,this.texureIndex);for(var r in this.buffers){var u=this.buffers[r];this.gl.useProgram(u.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture)}this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture),this.uniform("2f","vec2",t+"Resolution",this.textures[t].width,this.textures[t].height)}}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){this.realToCSSPixels=window.devicePixelRatio||1;var t=Math.floor(this.gl.canvas.clientWidth*this.realToCSSPixels),e=Math.floor(this.gl.canvas.clientHeight*this.realToCSSPixels);return(this.gl.canvas.width!==t||this.gl.canvas.height!==e)&&(this.gl.canvas.width=t,this.gl.canvas.height=e,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.resizeSwappableBuffers(),!0}else return!1}},{key:"render",value:function(){if(this.visible=Ee(this.canvas),this.forceRender||this.change||this.animated&&this.visible&&!this.paused){var t=new Date,e=performance.now();this.timeDelta=(e-this.timePrev)/1e3,this.timePrev=e,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(e-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*3600+t.getMinutes()*60+t.getSeconds()+t.getMilliseconds()*.001),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height);for(var i in this.buffers){var r=this.buffers[i];this.uniform("1i","sampler2D",r.name,r.bundle.input.index)}this.texureIndex=this.BUFFER_COUNT;for(var u in this.textures)this.uniformTexture(u),this.texureIndex++;this.renderPrograms(),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"renderPrograms",value:function(){var t=this.gl,e=t.canvas.width,i=t.canvas.height;t.viewport(0,0,e,i);for(var r in this.buffers){var u=this.buffers[r];u.bundle.render(e,i,u.program,u.name),t.bindFramebuffer(t.FRAMEBUFFER,null)}t.useProgram(this.program),t.drawArrays(t.TRIANGLES,0,6)}},{key:"getBuffers",value:function(t){var e={};return t&&t.replace(/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,function(){var i=arguments[3]||arguments[4];e["u_buffer"+i]={fragment:"#define BUFFER_"+i+`
`+t}}),e}},{key:"loadPrograms",value:function(t){var e=this,i=this.gl,r=x(e,e.vertexString,i.VERTEX_SHADER);for(var u in t){var o=t[u],l=x(e,o.fragment,i.FRAGMENT_SHADER,1);l?e.isValid=!0:(l=x(e,`void main(){
	gl_FragColor = vec4(1.0);
}`,i.FRAGMENT_SHADER),e.isValid=!1);var h=J(e,[r,l]);o.name=u,o.program=h,o.bundle=e.createSwappableBuffer(e.canvas.width,e.canvas.height,h),i.deleteShader(l)}i.deleteShader(r)}},{key:"createSwappableBuffer",value:function(t,e,i){var r=this.createBuffer(t,e,i),u=this.createBuffer(t,e,i),o=this.gl;return{input:r,output:u,swap:function(){var h=r;r=u,u=h,this.input=r,this.output=u},render:function(h,c,a,f){o.useProgram(a),o.viewport(0,0,h,c),o.bindFramebuffer(o.FRAMEBUFFER,this.input.buffer),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.output.texture,0),o.drawArrays(o.TRIANGLES,0,6),this.swap()},resize:function(h,c,a,f){o.useProgram(a),o.viewport(0,0,h,c),this.input.resize(h,c),this.output.resize(h,c)}}}},{key:"createBuffer",value:function(t,e,i){var r=this.gl,u=this.BUFFER_COUNT;this.BUFFER_COUNT+=2,r.getExtension("OES_texture_float");var o=r.createTexture();r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var l=r.createFramebuffer();return{index:u,texture:o,buffer:l,W:t,H:e,resize:function(c,a){r.bindFramebuffer(r.FRAMEBUFFER,l);var f=Math.min(c,this.W),d=Math.min(a,this.H),v=new Float32Array(f*d*4);r.readPixels(0,0,f,d,r.RGBA,r.FLOAT,v),r.bindFramebuffer(r.FRAMEBUFFER,null);var E=u+1,m=r.createTexture();r.activeTexture(r.TEXTURE0+E),r.bindTexture(r.TEXTURE_2D,m),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,c,a,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,f,d,r.RGBA,r.FLOAT,v);var p=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,m),u=this.index=u,o=this.texture=m,l=this.buffer=p,this.W=c,this.H=a}}}},{key:"resizeSwappableBuffers",value:function(){var t=this.gl,e=t.canvas.width,i=t.canvas.height;t.viewport(0,0,e,i);for(var r in this.buffers){var u=this.buffers[r];u.bundle.resize(e,i,u.program,u.name)}t.useProgram(this.program)}},{key:"version",value:function(){return"0.1.7"}}]),s}();function ye(){var s=document.getElementsByClassName("glslCanvas");if(s.length>0){window.glslCanvases=[];for(var n=0;n<s.length;n++){var t=new Re(s[n]);t.isValid&&window.glslCanvases.push(t)}}}window.addEventListener("load",function(){ye()});export{Re as default};
